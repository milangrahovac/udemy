suite: test hook delete policy
templates:
  - tests/test-connection.yaml
tests:
  - it: should create a pod for testing purposes
    asserts:
      - isKind:
          of: Pod
      - matchRegex:
          path: metadata.name
          pattern: -test-connection$
  - it: should set the delete policy to "before-hook-creation,hook-succeeded" by default
    asserts:
      - equal:
          path: metadata.annotations["helm.sh/hook-delete-policy"]
          value: before-hook-creation,hook-succeeded
  - it: should corrently set the delete policy to before-hook-creation when tests.hookDeletePolies is not set
    set:
      tests:
        hookDeletePolicies: []
    asserts:
      - equal:
          path: metadata.annotations["helm.sh/hook-delete-policy"]
          value: before-hook-creation
